{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "GodotDialogue",
	"patterns": [
		{
			"match": "(=><|=>)\\s*([^\\s#]+)",
			"captures": {
				"1": { "name": "keyword.operator.goto.godotdialogue" },
				"2": { "name": "string.unquoted.goto-target.godotdialogue" }
			}
		},
		{
			"include": "#speaker"
		},
		{
			"include": "#comment"
		},
		{
			"include": "#title"
		},
		{
			"include": "#import"
		},
		{
			"include": "#using"
		},
		{
			"include": "#conditions"
		},
		{
			"include": "#mutations"
		},
		{
			"include": "#goto"
		},
		{
			"include": "#response"
		},
		{
			"include": "#random"
		},
		{
			"include": "#tags"
		},
		{
			"include": "#replacements"
		},
		{
			"include": "#keywords"
		},
		{
			"include": "#strings"
		}
	],
	"repository": {
		"speaker": {
			"patterns": [
				{
					"name": "entity.name.section.speaker.godotdialogue",
					"match": "\\s*([A-Za-z0-9_\\- ]+):"
				}
			]
		},
		"comment": {
			"patterns": [
				{
					"name": "comment.line.number-sign.godotdialogue",
					"match": "^\\s*#.*$"
				}
				,
				{
					"name": "comment.line.number-sign.godotdialogue",
					"match": "#.*$"
				}
			]
		},
		"title": {
			"patterns": [
				{
					"name": "entity.name.section.title.godotdialogue",
					"match": "^\\s*~\\s+.*$"
				}
			]
		},
		"import": {
			"patterns": [
				{
					"match": "^\\s*(import)\\s+\"([^\"]+)\"\\s+as\\s+([A-Za-z_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}][A-Za-z_0-9\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}]*)",
					"captures": {
						"1": { "name": "keyword.other.import.godotdialogue" },
						"2": { "name": "string.quoted.double.path.godotdialogue" },
						"3": { "name": "entity.name.import.godotdialogue" }
					}
				}
			]
		},
		"using": {
			"patterns": [
				{
					"match": "^\\s*(using)\\s+(.*)$",
					"captures": {
						"1": { "name": "keyword.other.using.godotdialogue" },
						"2": { "name": "variable.other.using.godotdialogue" }
					}
				}
			]
		},
			"conditions": {
				"patterns": [
					{
						"begin": "^\\s*(if|else if|elif|else|while|match|when)\\b\\s*",
					"beginCaptures": {
						"1": { "name": "keyword.control.godotdialogue" }
					},
					"end": "$",
					"patterns": [
						{ "include": "#expressions" },
						{ "include": "#strings" },
						{ "include": "#replacements" },
						{ "include": "#tags" },
						{ "include": "#comment" }
					]
				}
			]
		},
		"mutations": {
			"patterns": [
				{
					"begin": "^\\s*(do!|do|set)\\b\\s*",
					"beginCaptures": {
						"1": { "name": "keyword.other.mutation.godotdialogue" }
					},
					"end": "$",
					"patterns": [
						{ "include": "#expressions" },
						{ "include": "#strings" },
						{ "include": "#replacements" },
						{ "include": "#tags" },
						{ "include": "#comment" }
					]
				}
			]
		},
		"goto": {
			"patterns": [
				{
					"match": "(=><|=>)\\s*(.*)",
					"captures": {
						"1": { "name": "keyword.operator.goto.godotdialogue" },
						"2": { "name": "string.unquoted.goto-target.godotdialogue" }
					}
				}
			]
		},
		"response": {
			"patterns": [
				{
					"begin": "^\\s*(-)\\s+",
					"beginCaptures": {
						"1": { "name": "punctuation.definition.response.godotdialogue" }
					},
					"end": "$",
					"patterns": [
						{
							"match": "(=><|=>)\\s*([^\\s#]+)",
							"captures": {
								"1": { "name": "keyword.operator.goto.godotdialogue" },
								"2": { "name": "string.unquoted.goto-target.godotdialogue" }
							}
						},
						{ "include": "#goto" },
						{ "include": "#expressions" },
						{ "include": "#strings" },
						{ "include": "#replacements" },
						{ "include": "#tags" },
						{ "include": "#comment" }
					]
				}
			]
		},
		"random": {
			"patterns": [
				{
					"name": "constant.other.random.godotdialogue",
					"match": "^\\s*%\\d*"
				}
			]
		},
		"tags": {
			"patterns": [
				{
					"begin": "\\[(if|do|set)\\s+",
					"beginCaptures": {
						"1": { "name": "keyword.control.godotdialogue" }
					},
					"end": "\\]",
					"patterns": [
						{ "include": "#expressions" }
					]
				},
				{
					"name": "keyword.control.godotdialogue",
					"match": "\\\\\/(if|do|set)\\]"
				},
				{
					"match": "\\[\\#([^\\]]*)\\]",
					"name": "meta.tag.godotdialogue",
					"captures": { "1": { "name": "entity.name.tag.godotdialogue" } }
				},
				{
					"match": "\\\\[([A-Za-z0-9_:\\\\-]+)(?:\\\\s+([^\\]]+))?\\\\]",
					"captures": {
						"1": { "name": "entity.name.tag.godotdialogue" },
						"2": { "name": "string.other.tag-args.godotdialogue" }
					}
				}
			]
		},
		"replacements": {
			"patterns": [
				{
					"name": "variable.other.replacement.godotdialogue",
					"match": "\\{\\{(.*?)\\}\\}"
				}
			]
		},
		"expressions": {
			"patterns": [
				{
					"name": "constant.numeric.godotdialogue",
					"match": "\\b-?\\d+(?:\\.\\d+)?\\b"
				},
				{
					"name": "constant.language.boolean.godotdialogue",
					"match": "\\b(true|false)\\b"
				},
				{
					"name": "keyword.operator.comparison.godotdialogue",
					"match": "(==|<=|>=|!=|\\bin\\b|<|>)"
				},
				{
					"name": "keyword.operator.assignment.godotdialogue",
					"match": "(\\+=|\\-=|\\*=|/=|=)"
				},
				{
					"name": "keyword.operator.math.godotdialogue",
					"match": "(\\+|\\-|\\*|/|%)"
				},
				{
					"name": "punctuation.separator.comma.godotdialogue",
					"match": ","
				},
				{
					"name": "punctuation.definition.brackets.godotdialogue",
					"match": "[\\(\\)\\[\\]\\{\\}]"
				},
				{
					"match": "\\b([A-Za-z_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}][A-Za-z0-9_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}]*)\\.([A-Za-z_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}][A-Za-z0-9_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}]*)\\s*(?=\\()",
					"captures": {
						"1": { "name": "variable.other.godotdialogue" },
						"2": { "name": "support.function.godotdialogue" }
					}
				},
				{
					"name": "support.function.godotdialogue",
					"match": "\\b[A-Za-z_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}][A-Za-z0-9_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}]*\\s*(?=\\()"
				},

				{
					"name": "variable.other.godotdialogue",
					"match": "\\b[A-Za-z_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}][A-Za-z0-9_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}]*(?:\\.[A-Za-z_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}][A-Za-z0-9_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}]*)+(?!\\s*\\()\\b"
				},
				{
					"name": "variable.other.godotdialogue",
					"match": "\\b[A-Za-z_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}][A-Za-z0-9_\\p{Emoji_Presentation}\\p{Han}\\p{Katakana}\\p{Hiragana}\\p{Cyrillic}]*\\b"
				}
			]
		}
		,
		"keywords": {
			"patterns": [{
				"name": "keyword.control.godotdialogue",
				"match": "\\b(if|while|for|return)\\b"
			}]
		},
		"strings": {
			"name": "string.quoted.double.godotdialogue",
			"begin": "\"",
			"end": "\"",
			"patterns": [
				{
					"name": "constant.character.escape.godotdialogue",
					"match": "\\\\."
				}
			]
		}
	},
	"scopeName": "source.dialogue"
}